<!DOCTYPE html><html lang="fr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="description" content="Independant business consultant, proficient developer. Focused on improving efficiency through technology."><meta name="keywords" content="Technology,Business Tools,Website,Consulting"><meta name="author" content="Charles-Henri Decultot"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/css/materialize.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css"><link rel="stylesheet" href="../../../styles/main.css"><link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon"><title>Charles-Henri Decultot | Consultant en Technologies</title><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      
ga('create', 'UA-35025071-2', 'auto');
ga('send', 'pageview');        

</script></head><body class="blue-grey lighten-5 blue-grey-text text-darken-2"> <header><div class="chip"><a href="/fr"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#000000" d="M5,13L9,17L7.6,18.42L1.18,12L7.6,5.58L9,7L5,11H21V13H5M21,6V8H11V6H21M21,16V18H11V16H21Z">         </path></svg></a></div></header><main><div class="container"><section id="article" class="row"><div class="col s12"><div class="card"><div class="card-image"><img src="../../../images/heroImages/20170308-webscraping.jpg" class="responsive-img"><span class="card-title">Collectez Facilement les Données d'une Page Web</span></div><div class="card-content"><div id="blogNav" class="row"><div id="blogHeader"><img id="logo" src="../../../images/CH-round.png" alt="Charles-Henri Decultot" class="circle"><div id="blogInfo"><strong>Charles-Henri Decultot</strong><br><span>8 mars 2017</span></div></div><div id="socialSharing" class="fixed-action-btn waves-effect waves-light horizontal click-to-toggle"><a href="#"><i class="material-icons">share</i></a><ul><li><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fwww.chdecultot.com%2Ffr%2Farticles%2Fcollectez-facilement-les-donn-es-d-une-page-web%2F" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i><img src="../../../images/facebook-48x48.png" srcset="../../../images/facebook-24x24.png 1x, ../../../images/facebook-48x48.png 2x" alt="Facebook Logo"></i></a></li><li><a href="https://plus.google.com/share?url=https%3A%2F%2Fwww.chdecultot.com%2Ffr%2Farticles%2Fcollectez-facilement-les-donn-es-d-une-page-web%2F" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i><img src="../../../images/Google+-48x48.png" srcset="../../../images/Google+-24x24.png 1x, ../../../images/Google+-48x48.png 2x" alt="Google+ Logo"></i></a></li><li><a href="https://twitter.com/intent/tweet?text=Collectez Facilement les Données d'une Page Weburl=https%3A%2F%2Fwww.chdecultot.com%2Ffr%2Farticles%2Fcollectez-facilement-les-donn-es-d-une-page-web%2F" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i><img src="../../../images/Twitter-48x48.png" srcset="../../../images/Twitter-24x24.png 1x, ../../../images/Twitter-48x48.png 2x" alt="Twitter Logo"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3A%2F%2Fwww.chdecultot.com%2Ffr%2Farticles%2Fcollectez-facilement-les-donn-es-d-une-page-web%2F&amp;title=Collectez Facilement les Données d'une Page Web&amp;summary=Vous avez besoin de récupérer les données d'une page web afin de les formater ou de les travailler avec dans un outil plus adapté ? Voici une méthode simple pour démarrer.&amp;source=Charles-Henri Decultot" onclick="javascript:window.open(this.href,'', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i><img src="../../../images/Linkedin-48x48.png" srcset="../../../images/Linkedin-24x24.png 1x, ../../../images/Linkedin-48x48.png 2x" alt="LinkedIn Logo"></i></a></li></ul></div><div id="blogContent"><article><p>Ces dernières semaines, j&#39;ai participé à l&#39;amélioration des traductions françaises d&#39;ERPNext avec d&#39;autres membres de la communauté.<br>Malgré le gros travail déjà effectué - plus de 4000 phrases ont été déjà validées sur un total de 7000 - il y a encore une grosse marge d&#39;amélioration.</p>
<p>Avec <a href="https://github.com/qrevel">Quentin Revel</a>, nous avons décidé de joindre nos efforts et de travailler en collaboration afin de diminuer la charge de travail pour chacun et d&#39;ajouter une pré-vérification du travail de l&#39;autre pour garantir  la qualité des traductions avant de les ajouter sur le <a href="https://translate.erpnext.com/">portail de traductions.</a><br></br></p>
<p>La manière la plus simple était du coup de créer un répertoire sur <a href="https://github.com/qrevel/erpnext-translations">Github</a>, de récupérer les données du portail de traductions, de les retravailler et de tout envoyer sur Github pour revue avant validation.</p>
<p>Le seul problème était de trouver un moyen d&#39;extraire ces données facilement et au bon format...</p>
<h4 id="la-structure-du-site-internet">La Structure du Site Internet</h4>
<p>Avant de s&#39;attaquer à la création d&#39;un script, nous devons comprendre la structure d&#39;une page web et de celle-ci en particulier.</p>
<p>Voilà une capture d&#39;écran du portail créé par <a href="https://frappe.io/">Frappe</a>, l&#39;équipe derrière ERPNext, pour faciliter la collaboration de la communauté. Pour être honnête, c&#39;est vraiment un superbe outil pour permettre aux personnes sans connaissances techniques de contribuer à un projet open-source.<br><img src="../../../images/articles/20170308-162105.png" alt=""><br></br></p>
<p>Maintenant, en appuyant sur CTRL+SHIFT+I dans Chrome, regardons comment son code HTML est structuré.<br><img src="../../../images/articles/20170308-163153.png" alt=""></p>
<p>Comme nous pouvons le voir, chaque phrase est contenue dans une balise &quot;div&quot; ayant la classe &quot;single-message&quot;.<br>A l&#39;intérieur de ce bloc, on trouve deux balises &quot;div&quot; séparées pour les phrases anglaises et les phrases traduites. Seule la traduction est reconnaissable grâce à une classe séparée nommée &quot;translated&quot;.</p>
<p>On peut donc imaginer extraire les données en deux étapes: d&#39;abord collecter tous les &quot;div&quot; contenant la classe &quot;single-message&quot; pour obtenir la liste de toutes les traductions, et ensuite diviser chaque object de cette liste en une colonne anglaise et une colonne française.</p>
<p>Nous avons juste besoin d&#39;extraire les phrases anglaises et françaises, par le nom du traducteur, la date ou le statut de vérification, mais ça aurait été possible également.</p>
<h4 id="l-ecriture-un-petit-script-d-extraction-de-donn-es">L&#39;Ecriture un Petit Script d&#39;Extraction de Données</h4>
<p>Je recommande d&#39;utiliser <a href="http://jupyter.org/">Jupyter Notebook</a> pour ce type d&#39;exercice, car c&#39;est facile à utiliser et très rapide à mettre en place.</p>
<pre><code class="lang-python"><span class="hljs-keyword">import</span> requests
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> bs4 <span class="hljs-keyword">import</span> BeautifulSoup

english = []
french = []

url = <span class="hljs-string">"https://translate.erpnext.com/view?lang=fr&amp;c=A"</span>
response = requests.get(url)
soup = BeautifulSoup(response.text, <span class="hljs-string">'lxml'</span>)
rows = soup.find_all(<span class="hljs-string">'div'</span>,attrs={<span class="hljs-string">"class"</span> : <span class="hljs-string">"single-message"</span>})
<span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> rows:
    nonTranslated_row = row.find(<span class="hljs-string">'i'</span>).previousSibling
    english.append(nonTranslated_row.string.strip())

    translated_row = row.find(<span class="hljs-string">'div'</span>,attrs={<span class="hljs-string">"class"</span> : <span class="hljs-string">"translated"</span>})
    french.append(translated_row.string.strip())

df = pd.DataFrame(data = {<span class="hljs-string">"English"</span>: english, <span class="hljs-string">"Français"</span>: french})
df.head(<span class="hljs-number">10</span>)

df.to_csv(<span class="hljs-string">"letter-a.csv"</span>, encoding=<span class="hljs-string">"utf-8"</span>)
</code></pre>
<p>Comme vous pouvez le voir, nous utilisons la librairie Pandas habituelle pour formater nos données et également une autre libraire qui s&#39;appelle BeautifulSoup. C&#39;est l&#39;outil qui va nous permettre d&#39;extraire les données du site web.</p>
<p>Les étapes d&#39;éxécution du script sont relativement simples:</p>
<ol>
<li>Il crée une matrice pour sauvegarder nos phrases anglaises et françaises.</li>
<li>Il va à l&#39;URL spécifiée, lit les données et les extrait.</li>
<li>Il trouve tous les &quot;div&quot; ayant la classe &quot;single-message&quot;.</li>
<li>Pour chaque objet trouvé plus haut, il cherche le mot anglais et le mot français.</li>
<li>Il formate les données en deux colonnes.</li>
<li>Il exporte un fichier .csv pour que nous puissions l&#39;éditer dans LibreOffice et travailler dessus plus efficacement.</li>
</ol>
<p>La seule petite astuce ici est la logique utilisée pour récupérer le mot anglais.</p>
<p>Pour le mot français, c&#39;est relativement facile puisque nous avons une classe spécifique sur la balise &quot;tag&quot;, mais pour le mot anglais il n&#39;y a aucun élément différenciateur des autres &quot;div&quot; dans la page.</p>
<p>Mais puisqu&#39;il y a une balise &quot;i&quot; juste en dessous du mot anglais et que c&#39;est la seule balise &quot;i&quot; dans l&#39;objet, nous pouvons dire au script de sélectionner l&#39;élément juste avant lui-même.</p>
<p>Exécutez juste la cellule de votre Jupyter Notebook et le fichier .csv sera exporté dans le dossier de votre script.</p>
<p>Vous pouvez faire la même opération pour chaque lettre sur le portail en changeant l&#39;URL et le nom du fichier d&#39;export en fonction de vos besoins.<br></br><br>Vous avez besoin d&#39;une analyse pour un projet ou de conseils sur ce sujet ? N&#39;hésitez pas à me contacter chez <a href="https://www.dokos.io">DOKOS</a>, je serai ravi de vous aider!</p>
</article></div></div><div class="row"><div id="disqus_thread"></div><script>var disqus_config = function () {
     this.page.url = myUrl;
     this.page.identifier = id; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
     var d = document, s = d.createElement('script');
     s.src = '//chdecultot.disqus.com/embed.js';
     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
     })();</script><noscript>Please enable JavaScript to view the: a(href="https://disqus.com/?ref_noscript") comments powered by Disqus.
</noscript></div></div></div></div></section></div></main><footer><div id="footer" class="container"><div class="center-align"><a href="https://twitter.com/chdecultot"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#000000" d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.27C8.28,9.09 5.11,7.38 3,4.79C2.63,5.42 2.42,6.16 2.42,6.94C2.42,8.43 3.17,9.75 4.33,10.5C3.62,10.5 2.96,10.3 2.38,10C2.38,10 2.38,10 2.38,10.03C2.38,12.11 3.86,13.85 5.82,14.24C5.46,14.34 5.08,14.39 4.69,14.39C4.42,14.39 4.15,14.36 3.89,14.31C4.43,16 6,17.26 7.89,17.29C6.43,18.45 4.58,19.13 2.56,19.13C2.22,19.13 1.88,19.11 1.54,19.07C3.44,20.29 5.7,21 8.12,21C16,21 20.33,14.46 20.33,8.79C20.33,8.6 20.33,8.42 20.32,8.23C21.16,7.63 21.88,6.87 22.46,6Z"></path></svg></a><a href="https://github.com/chdecultot" style="margin-left: 5px;"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#000000" d="M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z"></path></svg></a><a href="https://fr.linkedin.com/in/chdecultot" style="margin-left: 5px;"><svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#000000" d="M21,21H17V14.25C17,13.19 15.81,12.31 14.75,12.31C13.69,12.31 13,13.19 13,14.25V21H9V9H13V11C13.66,9.93 15.36,9.24 16.5,9.24C19,9.24 21,11.28 21,13.75V21M7,21H3V9H7V21M5,3A2,2 0 0,1 7,5A2,2 0 0,1 5,7A2,2 0 0,1 3,5A2,2 0 0,1 5,3Z"></path></svg></a></div><div class="footer-copyright center-align"><p> 
©2016-2017 Charles-Henri Decultot</p></div></div></footer><script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.7/js/materialize.min.js"></script><script type="text/javascript" src="../../../scripts/malarkey.min.js"></script><script type="text/javascript" src="../../../scripts/main.js"></script><script id="dsq-count-scr" src="//chdecultot.disqus.com/count.js" async></script></body></html>